{% extends "layout.html" %}
{% block title %}Book Room{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-900 to-blue-700 py-12 px-4 flex justify-center items-start">
  <div class="w-full max-w-3xl bg-blue-800 bg-opacity-60 backdrop-blur-md shadow-2xl rounded-3xl p-8 space-y-6 text-white">

    <h2 class="text-3xl font-bold text-white text-center mb-6">Guest Details</h2>

    <form id="booking-form" method="post" class="space-y-5">
      <input name="name" placeholder="Your Name" required class="w-full px-4 py-3 rounded-xl border border-blue-300 bg-blue-700 placeholder-blue-200 text-white focus:ring-2 focus:ring-cyan-400 shadow-inner">
      <input name="email" placeholder="Your Email" type="email" required class="w-full px-4 py-3 rounded-xl border border-blue-300 bg-blue-700 placeholder-blue-200 text-white focus:ring-2 focus:ring-cyan-400 shadow-inner">
      <input name="phone" placeholder="Mobile Number" required class="w-full px-4 py-3 rounded-xl border border-blue-300 bg-blue-700 placeholder-blue-200 text-white focus:ring-2 focus:ring-cyan-400 shadow-inner">
      <input name="govt_id" placeholder="Govt. ID (Aadhaar/PAN/License)" required class="w-full px-4 py-3 rounded-xl border border-blue-300 bg-blue-700 placeholder-blue-200 text-white focus:ring-2 focus:ring-cyan-400 shadow-inner">

      <div>
        <h3 class="text-xl font-semibold text-cyan-200 mt-4 mb-2">Co-customers</h3>
        <div id="co-customers-container" class="space-y-4"></div>
      </div>

      <div class="text-center pt-4">
        <button type="button" onclick="showSummary()" class="px-6 py-3 bg-gradient-to-r from-cyan-400 to-blue-500 hover:from-cyan-500 hover:to-blue-600 text-white font-semibold rounded-xl transition duration-300 shadow-lg">
          Confirm Booking
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Summary Modal -->
<div id="summary-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center">
  <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 space-y-4">
    <h2 class="text-xl font-bold text-blue-700 text-center">Review Your Booking</h2>
    <div id="summary-content" class="text-sm text-gray-700 space-y-2"></div>
    <div class="flex justify-between pt-4">
      <button onclick="closeModal()" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-xl font-medium">Edit</button>
      <button onclick="submitForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-medium">Final Submit</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const guestCount = {{ session.get('guest_count', 1) }};
    const container = document.getElementById('co-customers-container');

    if (guestCount > 1) {
      for (let i = 1; i < guestCount; i++) {
        const div = document.createElement('div');
        div.classList.add("grid", "grid-cols-1", "gap-2");
        div.innerHTML = `
          <p class="text-blue-100 font-medium">Co-customer ${i}:</p>
          <input name="co_name_${i}" placeholder="Name" required class="w-full px-4 py-3 rounded-xl border border-blue-300 bg-blue-700 placeholder-blue-200 text-white focus:ring-2 focus:ring-cyan-400 shadow-inner">
          <input type="number" name="co_age_${i}" placeholder="Age" required class="w-full px-4 py-3 rounded-xl border border-blue-300 bg-blue-700 placeholder-blue-200 text-white focus:ring-2 focus:ring-cyan-400 shadow-inner">
        `;
        container.appendChild(div);
      }
    }
  });

  function showSummary() {
    const form = document.getElementById('booking-form');
    const name = form.name.value;
    const email = form.email.value;
    const phone = form.phone.value;
    const govt_id = form.govt_id.value;
    const guestCount = {{ session.get('guest_count', 1) }};

    let summary = `
      <p><strong>Name:</strong> ${name}</p>
      <p><strong>Email:</strong> ${email}</p>
      <p><strong>Phone:</strong> ${phone}</p>
      <p><strong>Govt ID:</strong> ${govt_id}</p>
      <p><strong>Total Guests:</strong> ${guestCount}</p>
    `;

    if (guestCount > 1) {
      for (let i = 1; i < guestCount; i++) {
        const coName = form[`co_name_${i}`]?.value || '';
        const coAge = form[`co_age_${i}`]?.value || '';
        summary += `<p><strong>Co-customer ${i}:</strong> ${coName} (Age: ${coAge})</p>`;
      }
    }

    document.getElementById('summary-content').innerHTML = summary;
    document.getElementById('summary-modal').classList.remove('hidden');
  }

  function closeModal() {
    document.getElementById('summary-modal').classList.add('hidden');
  }

  function submitForm() {
    document.getElementById('booking-form').submit();
  }
</script>
{% endblock %}
